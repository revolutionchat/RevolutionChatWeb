<DOCTYPE html>
<html style="margin: 0; overflow: hidden; background: grey;">
  <head style="overflow:hidden;">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <title>Client Home | Revolution</title>
    <script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", function() {
    navigator.serviceWorker
      .register("/static/js/serviceWorker.js")
      .then(res => console.log("service worker registered - serviceWorker.js"))
      .catch(err => console.log("service worker not registered - ", err))
  })
}
  </script>
  
    <meta name="apple-mobile-web-app-status-bar" content="#fff" />
    <meta name="theme-color" content="#db4938" />
    <link rel="apple-touch-icon" href="/assets/images/Goobler-meowsicles.png" />
    <link rel="manifest" href="/static/manifest.json">
    <meta name="description" content="Goobler created PWA Application">

    <meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", function() {
    navigator.serviceWorker
      .register("/serviceWorker.js")
      .then(res => console.log("service worker registered - serviceWorker.js"))
      .catch(err => console.log("service worker not registered - ", err))
  })
}
  </script>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  
    <meta name="apple-mobile-web-app-status-bar" content="#fff" />
    <meta name="theme-color" content="#db4938" />
    <link rel="apple-touch-icon" href="/assets/images/Revolution.png" />
    <link rel="manifest" href="/static/manifest.webmanifest">
    <meta name="description" content="Revolution created PWA Application">

    <div class="alert" id="network-change-alert" style="color: blue;" hidden>
      <span class="material-symbols-outlined">wifi</span> &nbsp;&nbsp; Your network connectivity is unstable and we can't connect you.
    </div>
    <script src="/static/js/connectivity-check.js"></script>
    <style>@font-face { font-family: "Gotham Narrow"; src: url("/static/fonts/gotham-narrow-book.woff2"); }</style>
    <!--<script src="https://premify2.ericplayzyt.repl.co/api/widget/js"></script>-->
<style>
/* width */
::-webkit-scrollbar {
  width: 10px;
}

/* Track */
::-webkit-scrollbar-track {
  box-shadow: inset 0 0 5px grey; 
  border-radius: 10px;
}
 
/* Handle */
::-webkit-scrollbar-thumb {
  background: grey; 
  border-radius: 10px;
}

/* Handle on hover */
::-webkit-scrollbar-thumb:hover {
  background: grey; 
}
  .invisible {
    opacity: 0;
    transition: all 0.5s ease;
  }
</style>
  </head>
  <body style="margin: 0; background: grey; overflow: hidden;">
    <div class="join-server-modal" hidden>
      <div class="join-server-modal-content">
      
      </div>
    </div>
    <div class="status-modal" hidden>
      <div class="status-modal-content">
      
      </div>
    </div>
  <div class="bottom-nav" style="background-color: black; position: fixed; bottom: 0; float: left; width: 100%;">
    <!-- NAV BAR CODE -->
    <img class="logo" src="/assets/images/Goobler-meowsicles.png" style="width: 50px; padding: 10px 5px 8px 5px; border-right:2px darkgrey solid;"></img>
    <img class="server-icons" src="/assets/images/addserver-icon.png" style="width: 50px; padding: 10px 5px 5px 5px;" onclick="showjoinNewServerModal();"></img>
    {% for item in guilds %}
      <a href="/channels/@s/{{item['serverid']}}">
        <button class="server-item" style="background: url('{{item['imgurl']|safe}}'); background-size: 100%;"><span style="visibility: hidden;">server.item</span></button>
      </a>
    {% endfor %}
    {% if 'joinedServer' in session %}
      <a href="/channels/@sLocal/{{session.get('joinedServer')['serverid']}}">
        <button class="server-item">{{session.get("joinedServer")["abbr"]}}</button>
    {% endif %}
      </div>
    <!-- page content code -->
    <!-- page content code -->
    <div class="content" style="background-color: #2f3136">
      <div class="content-inner" style="position: absolute; left: 20%; color: white; width: 78.5%;">
        <div class="banner" style="margin: 10px; background: url('/assets/images/defaultBanner.jpg'); padding: 30px; width: 100%; border-radius: 15px;">
          <h2>Add a user</h2>
        </div>
        <hr>
        <div class="contnt" style="margin-left: 20px;">
          <h2>Who would you like to add?</h2>
          <form method="post" action="/action/add">
            <label for="username">Username</label>
            <input type="text" id="username" name="username"><br/>
            <input type="submit" value="Submit">
          </form>
            
        </div>
      </div>
      <div class="message-list">
        
        <div class="flex-shrink-0 p-3" style="width: 20%; height: 100%; background: #222222;">
    <a href="#" class="d-flex align-items-center pb-3 mb-3 link-light text-decoration-none" style="background: rgba(56,56,56,1); padding: 5px 5px; border-radius: 10px;">
      <img class="logo" src="/assets/images/Revolution-TR.png" style="width: 50px;">&nbsp;Messages</img>
      <button class="joinNewConv-btn btn-dark" style="border-radius: 6px; border: 0; outline: 0; font-weight: bold; margin-left: 10px;" onclick="alert(`Joining conversations and creating them aren't supported yet.`)">&plus;</button>
    </a>
    <div class="border-top" style="border-image: linear-gradient(to right, darkblue, darkorchid) 1;"></div>
    <br>
    <ul class="list-unstyled ps-0">
      <div class="message-item mb-2">
        <a href="/channels/@system" class="message-item-link"><img src="/assets/images/Revolution.png" width="30" style="border-radius: 50%; padding: 5px 5px;">&nbsp;&nbsp;Revolution</a>
      </div>
      <div class="message-item mb-2">
        <a href="/channels/@ai" class="message-item-link"><img src="/assets/images/Revolution.png" width="30" style="border-radius: 50%; padding: 5px 5px;">&nbsp;&nbsp;Revolved AI</a>
      </div>
      <div class="message-item mb-2">
        <a href="/channels/@add" class="message-item-link"><img src="/assets/images/addserver-icon.png" width="30" style="border-radius: 50%; padding: 5px 5px; margin-bottom: 5px;">&nbsp;&nbsp;Add person</a>
      </div>
      <button class="btn btn-dark" style="width: 90%; margin-top: 6px;" onclick="toggleDiscoveryWindow();">Switch to Discovery</button>
      <button class="btn btn-dark" style="width: 90%; margin-top: 6px;" onclick="alert('Games are experimental and used for playing in VC with your friends.')">Games</button>
      <button class="btn btn-primary" style="width: 90%; margin-top: 6px;" onclick="document.body.style.background = '#444'; document.body.classList.add('invisible'); window.location.href = '@settings';">Settings</button>
          </ul>
        </div>
        <!-- bottom user profile -->
        <div class="user-profile-main" style="position: fixed; bottom: 55px; width: 20%; height: 60px; background: #444444; color: white; padding: 2px; justify-content: left; align-items: center; display: flex;">
          <img src="/assets/images/Revolution.png" style="border-radius: 50%; width: 35px; margin-right: 10px; display: inline-block;"> <span class="position-absolute top-0 start-100 translate-middle p-2 bg-success rounded-circle" style="border: 6px #444444 solid; cursor: pointer;" onclick="showStatusModal();"></span><h7 style="display: inline-block;"> {{user}}<strong style="color: grey;">#{{usertag}}</strong></h7>
          <button class="joinNewConv-btn btn-danger" style="border-radius: 6px; border: 0; outline: 0; font-weight: bold; margin-left: 10px;" onclick="window.location.href='@logoutAction';">Logout</button>
        <!-- end bottom user profile -->
        </div>
  </div>
    </div>
     <link rel="stylesheet" href="/static/css/client.css">
<link rel="stylesheet" href="/static/css/cmenu.css">
<link rel="stylesheet" href="/static/css/modals.css">

    <!-- CONTEXTMENU CODING: -->
    <script>
      window.onclick = hideMenu; 
window.oncontextmenu = rightClick; 

function hideMenu() { 
  if (document.getElementById('contextMenu').style.display == "") {
    document.getElementById("contextMenu").style.left = "-120px"
  }
} 

function rightClick(e) { 
  e.preventDefault(); 

  if (document.getElementById("contextMenu").style.display == ""){
    var menu = document.getElementById("contextMenu");
    menu.style.display = "";
    menu.style.left = e.pageX + "px"; 
    menu.style.top = e.pageY + "px"; 
  }else{ 
    hideMenu();
  } 
}

window.addEventListener('contextmenu', (e) => {e.preventDefault(); rightClick(e);})

function copyText() {
  navigator.clipboard
    .writeText(window.location.href)
    .then(() => {
      alert("Copied the URL.");
    })
    .catch(() => {
      alert("Unable to copy the URL.");
    });
}
    </script>

<script>
  function startCapture(displayMediaOptions) {
 return navigator.mediaDevices.getDisplayMedia(displayMediaOptions)
    .catch(err => { console.error("Error:" + err); return null; });
}
</script>
  
    <div id="contextMenu" class="context-menu" style="position: fixed;"> 
        <ul class="cmenu"> 
            <li class="share" onclick="copyText()"><a href="#"><i class="fa fa-share" aria-hidden="true"></i> Share</a></li>
        </ul> 
    </div>


  </head>
  </body><script src="/static/js/server.js"></script>
<script>
  function showjoinNewServerModal() {
    let Modal = document.querySelector('.join-server-modal');
    let ModalInnerContent = document.querySelector('.join-server-modal-content');
    let defaultContent = "<small style='position:fixed;top:36%; color: gray;'>JOIN A NEW SERVER</small><form method='get' action='/channels/@join'><input name='id' placeholder='URI' class='input-of-text'/><div class='join-server-modal-buttons'><button class='btn btn-primary' style='width:100% !important; cursor: not-allowed;'>Join</button></form><button class='btn btn-danger' style='width:100% !important; cursor: not-allowed;' onclick='closeJoinServerModal()'>Exit</button></div>";
      ModalInnerContent.innerHTML = "<img style='width:50px;' src='/assets/images/imggooblerloader.gif'>";
      Modal.hidden = false;
      setTimeout(function() {
        ModalInnerContent.innerHTML = defaultContent;
      },10000)
    }

  function closeJoinServerModal() {
    document.querySelector('.join-server-modal').hidden = true;
  }

  function showStatusModal() {
    let Modal = document.querySelector('.status-modal');
    let ModalInnerContent = document.querySelector('.status-modal-content');
    let defaultContent = "<small style='position:fixed;top:36%; color: gray;'>Set a new status!</small><p>Setting statuses is not avaliable in this current update.</p><div class='status-modal-buttons'><button class='btn btn-primary' style='width:100% !important; cursor: not-allowed;'>Set status (Exit)</button></div>";
      ModalInnerContent.innerHTML = "<img style='width:50px;' src='/assets/images/imggooblerloader.gif'> <br> <p style='color:white;'>Loading...</p>";
      Modal.hidden = false;
      setTimeout(function() {
        ModalInnerContent.innerHTML = defaultContent;
      },10000)
  }

  function toggleDiscoveryWindow() {
    const discoveryWindow = document.querySelector('.discovery-window');
    const messageList = document.querySelector('.message-list');
    const contentInner = document.querySelector('.content-inner');
    if(discoveryWindow.hidden == true) {
      discoveryWindow.hidden = false;
      messageList.hidden = true;
      contentInner.hidden = true;
    }else{
      discoveryWindow.hidden = true;
      messageList.hidden = false;
      contentInner.hidden = false;
    }
  }

  async function determineUserRoleCT(el, em) {
    ft = await fetch(`/api/roles/determine?email=${em}`);
    ftText = await ft.text()
    if (ftText.includes("[]")) {
      el.innerHTML = "No role found."
    }
    if (ftText.includes('Error')) {
      el.innerHTML = "Error retrieving information."
      alert("There is an error with your account. Please contact support team and send this code: xERROR_RETRIEVING-NOT_VALID_EMAILx")
    }
    if (ftText.includes('isModerator')) {
      el.innerHTML = "Moderator"
    }
    if (ftText.includes('isAdmin')) {
      el.innerHTML = "Administrator"
    }
    if (ftText.includes('isOwner')) {
      el.innerHTML = "Owner"
    }
    el.onclick = null
  }
</script>
      </div>
    </div>
  </body>
</html>